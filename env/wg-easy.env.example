# wg-easy main settings
WG_HOST=vpn.mydomain.com
WG_PORT=51820
WG_DEFAULT_ADDRESS=100.64.x.x
WG_DEFAULT_DNS=8.8.8.8, 1.1.1.1
WG_MTU=1420
# WG_ALLOWED_IPS=0.0.0.0/0, ::/0

# Restrict clients to only the vpn-client-net network (split tunnel)
WG_ALLOWED_IPS=192.0.2.16/29

# Web UI variables:
INSECURE=true                # Allow HTTP access to the UI (set to false later for production)
PORT=51821                   # Web UI listen port inside container (default anyway, but explicit helps)

# Disable IPv6 completely:
DISABLE_IPV6=true

# Variables to enable routing and NAT for the vpn-client-net subnet (192.0.2.16/29):

# WG_POST_UP=iptables -t nat -A POSTROUTING -o wg0 -j MASQUERADE
# WG_POST_UP_1=iptables -A FORWARD -i wg0 -j ACCEPT
# WG_POST_UP_2=iptables -A FORWARD -o wg0 -j ACCEPT
# WG_POST_UP_3=iptables -t nat -A POSTROUTING -s 192.0.2.16/29 -o wg0 -j MASQUERADE

# WG_POST_DOWN=iptables -t nat -D POSTROUTING -o wg0 -j MASQUERADE
# WG_POST_DOWN_1=iptables -D FORWARD -i wg0 -j ACCEPT
# WG_POST_DOWN_2=iptables -D FORWARD -o wg0 -j ACCEPT
# WG_POST_DOWN_3=iptables -t nat -D POSTROUTING -s 192.0.2.16/29 -o wg0 -j MASQUERADE







# Add any other non-secret options you want (WG_PERSISTENT_KEEPALIVE, WG_PRE_UP, etc.)



# Firewall + NAT rules (only allow traffic to vpn-client-net)

WG_POST_UP=iptables -t nat -A POSTROUTING -s 100.64.0.0/16 -o eth0 -j MASQUERADE
WG_POST_UP_1=iptables -A INPUT -p udp --dport 51820 -j ACCEPT
WG_POST_UP_2=iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
WG_POST_UP_3=iptables -A FORWARD -i wg0 -d 192.0.2.16/29 -j ACCEPT
WG_POST_UP_4=iptables -A FORWARD -i wg0 -j DROP

WG_POST_DOWN=iptables -t nat -D POSTROUTING -s 100.64.0.0/16 -o eth0 -j MASQUERADE
WG_POST_DOWN_1=iptables -D INPUT -p udp --dport 51820 -j ACCEPT
WG_POST_DOWN_2=iptables -D FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
WG_POST_DOWN_3=iptables -D FORWARD -i wg0 -d 192.0.2.16/29 -j ACCEPT
WG_POST_DOWN_4=iptables -D FORWARD -i wg0 -j DROP


# Optional: if you later want VPN clients to talk directly to each other, uncomment this line and add it before the DROP rule in WG_POST_UP:
# iptables -A FORWARD -i wg0 -o wg0 -j ACCEPT;